# Tutorial: Implementando API REST com JsonServer e Flutter

Este tutorial irá guiá-lo na integração de uma API REST criada com o **JsonServer** ao **Flutter**, usando métodos `GET` e `POST` para manipular dados de produtos.


## Sumário

1. [Passo 1: Configurando o JsonServer](#passo-1-configurando-o-jsonserver)
   - [Criando o produtos.js](#criando-o-produtosjs)
   - [Executando o JsonServer](#executando-o-jsonserver)
2. [Passo 2: Configurando o Flutter](#passo-2-configurando-o-flutter)
   - [Estrutura do Projeto](#estrutura-do-projeto)
   - [Criando o Modelo Produto](#criando-o-modelo-produto)
3. [Passo 3: Criando o Serviço HTTP para GET e POST](#passo-3-criando-o-serviço-http-para-get-e-post)
4. [Passo 4: Interface no Flutter com Formulário para Adicionar Produtos](#passo-4-interface-no-flutter-com-formulário-para-adicionar-produtos)
5. [Passo 5: Adicionar o pacote http no arquivo pubspec.yaml](#passo-5-adicionar-o-pacote-http-no-arquivo-pubspecyaml)



## Passo 1: Configurando o JsonServer

### Criando o `produtos.js`

Crie uma pasta chamada `json-server` na raiz do projeto.

Dentro da pasta `json-server` crie um arquivo chamado `produtos.js` que será usado pelo JsonServer para a API REST.

```json
{
  "produtos": [
    {
      "id": 1,
      "nome": "Camiseta",
      "preco": 49.99,
      "descricao": "Camiseta de algodão"
    },
    {
      "id": 2,
      "nome": "Calça Jeans",
      "preco": 89.99,
      "descricao": "Calça jeans azul"
    }
  ]
}
```

### Executando o JsonServer
Navegue até a pasta `json-server` e execute o comando abaixo para iniciar o servidor na porta 3000:
```
npx json-server --watch produtos.js --port 3000
```

Isso cria um servidor API REST local na URL http://localhost:3000/produtos.


## Passo 2: Configurando o Flutter
### Estrutura do Projeto
Organize a estrutura do projeto como abaixo:
```
lib/
|-- main.dart
|-- produto.dart
|-- produto_service.dart
```


### Criando o Modelo Produto
No arquivo `produto.dart`, defina o modelo que representa um produto.

```dart
class Produto {
  final String id;
  final String nome;
  final double preco;
  final String descricao;

  Produto({required this.id, required this.nome, required this.preco, required this.descricao});

  // Converter JSON para Produto
  factory Produto.fromJson(Map<String, dynamic> json) {
    return Produto(
      id: json['id'].toString(),
      nome: json['nome'],
      preco: double.parse(json['preco'].toString()),
      descricao: json['descricao'],
    );
  }

  // Converter Produto para JSON
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'nome': nome,
      'preco': preco,
      'descricao': descricao,
    };
  }
}
```

## Passo 3: Criando o Serviço HTTP para GET e POST
No arquivo `produto_service.dart`, implemente o serviço que fará a comunicação com a **API**.

```dart
import 'dart:convert';
import 'package:http/http.dart' as http;
import 'produto.dart';

class ProdutoService {
    // Substitua pelo ip da sua máquina
  final String apiUrl = "http://192.168.x.x:3000/produtos";

  // Método GET para buscar os produtos
  Future<List<Produto>> fetchProdutos() async {
    final response = await http.get(Uri.parse(apiUrl));

    if (response.statusCode == 200) {
      List<dynamic> body = json.decode(response.body);
      List<Produto> produtos = body.map((dynamic item) => Produto.fromJson(item)).toList();
      return produtos;
    } else {
      throw Exception("Erro ao carregar produtos");
    }
  }

  // Método POST para adicionar um novo produto
  Future<Produto> createProduto(Produto produto) async {
    final response = await http.post(
      Uri.parse(apiUrl),
      headers: {"Content-Type": "application/json"},
      body: json.encode({
        'nome': produto.nome,
        'preco': produto.preco,
        'descricao': produto.descricao,
      }),
    );

    if (response.statusCode == 201) {
      return Produto.fromJson(json.decode(response.body));
    } else {
      throw Exception("Erro ao criar produto");
    }
  }
}
```

## Passo 4: Interface no Flutter com Formulário para Adicionar Produtos
No arquivo `main.dart`, crie a interface de usuário.

```dart
import 'package:flutter/material.dart';
import 'produto.dart';
import 'produto_service.dart';

void main() {
  runApp(ProdutosApp());
}

class ProdutosApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Produtos App',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: ProdutosPage(),
    );
  }
}

class ProdutosPage extends StatefulWidget {
  @override
  _ProdutosPageState createState() => _ProdutosPageState();
}

class _ProdutosPageState extends State<ProdutosPage> {
  late Future<List<Produto>> produtos;
  final ProdutoService service = ProdutoService();

  // Controladores de texto para capturar os dados dos campos
  final TextEditingController nomeController = TextEditingController();
  final TextEditingController precoController = TextEditingController();
  final TextEditingController descricaoController = TextEditingController();

  @override
  void initState() {
    super.initState();
    produtos = service.fetchProdutos(); // Carregar os produtos
  }

  // Método para adicionar novo produto
  void _adicionarProduto() async {
    if (nomeController.text.isEmpty || precoController.text.isEmpty || descricaoController.text.isEmpty) {
      return;
    }

    Produto novoProduto = Produto(
      id: "0", // ID será gerado pelo servidor
      nome: nomeController.text,
      preco: double.parse(precoController.text),
      descricao: descricaoController.text,
    );

    await service.createProduto(novoProduto);

    // Atualizar a lista de produtos após adicionar
    setState(() {
      produtos = service.fetchProdutos();
    });

    // Limpar os campos de texto
    nomeController.clear();
    precoController.clear();
    descricaoController.clear();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Lista de Produtos'),
      ),
      body: Column(
        children: [
          // Formulário para adicionar produto
          Padding(
            padding: const EdgeInsets.all(8.0),
            child: Column(
              children: [
                TextField(
                  controller: nomeController,
                  decoration: InputDecoration(labelText: 'Nome do Produto'),
                ),
                TextField(
                  controller: precoController,
                  decoration: InputDecoration(labelText: 'Preço'),
                  keyboardType: TextInputType.number,
                ),
                TextField(
                  controller: descricaoController,
                  decoration: InputDecoration(labelText: 'Descrição'),
                ),
                ElevatedButton(
                  onPressed: _adicionarProduto,
                  child: Text('Adicionar Produto'),
                ),
              ],
            ),
          ),
          Expanded(
            child: FutureBuilder<List<Produto>>(
              future: produtos,
              builder: (context, snapshot) {
                if (snapshot.connectionState == ConnectionState.waiting) {
                  return Center(child: CircularProgressIndicator());
                } else if (snapshot.hasError) {
                  return Center(child: Text('Erro: ${snapshot.error}'));
                } else if (!snapshot.hasData || snapshot.data!.isEmpty) {
                  return Center(child: Text('Nenhum produto encontrado'));
                }

                List<Produto> produtos = snapshot.data!;
                return ListView.builder(
                  itemCount: produtos.length,
                  itemBuilder: (context, index) {
                    final produto = produtos[index];
                    return ListTile(
                      title: Text(produto.nome),
                      subtitle: Text('Preço: R\$${produto.preco.toStringAsFixed(2)}'),
                      trailing: Text(produto.descricao),
                    );
                  },
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

## Passo 5: Adicionar o pacote http no arquivo pubspec.yaml
No arquivo `pubspec.yaml` do seu projeto Flutter, adicione a dependência http na seção dependencies:

```
dependencies:
  flutter:
    sdk: flutter
  http: ^0.14.0
```

ou execute o código abaixo no terminal:
```
flutter pub add http
```
